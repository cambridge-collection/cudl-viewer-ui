"use strict";(()=>{function d(a,n,e={encode:!0}){return a.replace(/\{(id|url|watchable|label)\}/g,(t,i)=>{let r=n[i]??"";return e.encode&&(i==="id"||i==="url"||i==="watchable")?encodeURIComponent(r):r})}function v(a){return a.replace(/[&<>"']/g,n=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[n]||n)}function y(a){return document.cookie.split(";").map(n=>n.trim()).find(n=>n.startsWith(`${a}=`))?.substring(a.length+1)||null}function f(a){return a&&typeof a=="object"&&!Object.isFrozen(a)&&(Object.getOwnPropertyNames(a).forEach(n=>{let e=a[n];e&&typeof e=="object"&&f(e)}),Object.freeze(a)),a}var u=class{constructor(){this.definitions={}}register(n,e){this.has(n)&&console.warn(`media-embed: re-registering service "${n}", existing definition will be overwritten.`);let t={...e};e.defaultEmbedParams&&(t.defaultEmbedParams={...e.defaultEmbedParams}),Array.isArray(e.idAttr)&&(t.idAttr=[...e.idAttr]),f(t),this.definitions[n]=t}get(n){return this.definitions[n]}has(n){return n in this.definitions}},c=new u,m={cookieName:"mediaEmbedConsent",cookieValue:"granted",set(a,n){this.cookieName=a,this.cookieValue=n}};function w(a,n){m.set(a,n)}window.configureMediaEmbedConsentCookie=w;window.mediaEmbedServiceRegistry={register:(a,n)=>c.register(a,n),has:a=>c.has(a),get:a=>c.get(a)};function g(){return y(m.cookieName)===m.cookieValue}c.register("youtube",{idAttr:"itemid",thumbnailTemplate:"https://i.ytimg.com/vi/{id}/hqdefault.jpg",highResPosterTemplate:"https://img.youtube.com/vi/{id}/maxresdefault.jpg",embedBaseTemplate:"https://www.youtube-nocookie.com/embed/{id}",watchUrlTemplate:"https://youtu.be/{id}",thumbnailOEmbedEndpointTemplate:"https://www.youtube.com/oembed?format=json&url={url}",playButtonHTML:`
    <button type="button" aria-label="{label}" style="position:absolute; inset:0; margin:auto; width:60px; height:60px; border:none; background:none; cursor:pointer;">
      <svg height="100%" version="1.1" viewBox="0 0 68 48" width="100%"><path class="ytp-large-play-button-bg" d="M66.52,7.74c-0.78-2.93-2.49-5.41-5.42-6.19C55.79,.13,34,0,34,0S12.21,.13,6.9,1.55 C3.97,2.33,2.27,4.81,1.48,7.74C0.06,13.05,0,24,0,24s0.06,10.95,1.48,16.26c0.78,2.93,2.49,5.41,5.42,6.19 C12.21,47.87,34,48,34,48s21.79-0.13,27.1-1.55c2.93-0.78,4.64-3.26,5.42-6.19C67.94,34.95,68,24,68,24S67.94,13.05,66.52,7.74z" fill="#f03"></path><path d="M 45,24 27,14 27,34" fill="#fff"></path></svg>
    </button>
  `,transparencyNoticeHTML:`Opens YouTube in a new tab. YouTube may set its own cookies (e.g., for preferences and analytics); see YouTube\u2019s 
    <a href="https://policies.google.com/privacy" target="_blank" rel="noopener noreferrer">Privacy Policy</a> and 
    <a href="https://policies.google.com/technologies/cookies" target="_blank" rel="noopener noreferrer">Cookie Policy</a>.`});c.register("soundcloud",{idAttr:["trackurl","trackid"],embedBaseTemplate:"https://w.soundcloud.com/player/",watchFallbackSearchTemplate:"https://soundcloud.com/search/sounds?q={id}",thumbnailOEmbedEndpointTemplate:"https://soundcloud.com/oembed?format=json&url={url}",thumbnailTemplate:"https://via.placeholder.com/560x315?text=SoundCloud+{id}",playButtonHTML:'<div class="default-playbtn" aria-hidden="true">\u25B6</div>',autoplayParam:"auto_play",defaultEmbedParams:{color:"#ff5500",auto_play:"false",hide_related:"false",show_comments:"true",show_user:"true",show_reposts:"false",show_teaser:"true"},transparencyNoticeHTML:`Opens SoundCloud in a new tab. SoundCloud may set its own cookies (e.g., for preferences and analytics); see SoundCloud\u2019s 
    <a href="https://soundcloud.com/pages/privacy" target="_blank" rel="noopener noreferrer">Privacy Policy</a> and 
    <a href="https://pages.soundcloud.com/legal/cookie-policy" target="_blank" rel="noopener noreferrer">Cookie Policy</a>.`});c.register("vimeo",{idAttr:"itemid",thumbnailOEmbedEndpointTemplate:"https://vimeo.com/api/oembed.json?url={url}",embedBaseTemplate:"https://player.vimeo.com/video/{id}",watchUrlTemplate:"https://vimeo.com/{id}",playButtonHTML:`
    <button type="button" aria-label="{label}" style="position:absolute; inset:0; margin:auto; width:60px; height:60px; border:none; background:none; cursor:pointer;">
      <svg aria-hidden="true" width="60" height="60" viewBox="0 0 64 64" style="display:block;">
        <circle cx="32" cy="32" r="30" fill="rgba(0,0,0,0.5)"/>
        <polygon points="26,20 46,32 26,44" fill="white"/>
      </svg>
    </button>
  `,transparencyNoticeHTML:`Opens Vimeo in a new tab. Vimeo may set its own cookies (e.g., for preferences and analytics); see Vimeo\u2019s 
    <a href="https://vimeo.com/privacy" target="_blank" rel="noopener noreferrer">Privacy Policy</a> and 
    <a href="https://vimeo.com/cookie_policy" target="_blank" rel="noopener noreferrer">Cookie Policy</a>.`});var h=class extends HTMLElement{constructor(){super();this.embedId=null;this.shadow=this.attachShadow({mode:"open"})}static get observedAttributes(){return["service","playlabel","title","autoplay","params","playlistindex","playlistid","itemid"]}get playLabel(){return this.getAttribute("playlabel")||"Play"}get titleText(){return this.getAttribute("title")||""}get autoplay(){if(!this.hasAttribute("autoplay"))return!1;let e=this.getAttribute("autoplay");return e===null?!0:/^(true|1)?$/i.test(e)}get playlistIndex(){let e=this.getAttribute("playlistindex");if(!e)return;let t=parseInt(e,10);if(!(!Number.isFinite(t)||t<=0))return t}get extraParams(){return new URLSearchParams(this.getAttribute("params")??"")}connectedCallback(){this.initialize()}attributeChangedCallback(e,t,i){this.initialize()}disconnectedCallback(){this.currentPlayButton&&this.currentPlayButtonHandler&&this.currentPlayButton.removeEventListener("click",this.currentPlayButtonHandler)}ensureStyles(){if(this.shadow.querySelector("style[data-media-embed]"))return;let e=document.createElement("style");e.setAttribute("data-media-embed",""),e.textContent=`
      .preview-wrapper {
        display: flex;
        flex-direction: column;
        height: 100%;
        width: 100%;
        box-sizing: border-box;
      }
      .media-container {
        position: relative;
        flex: 1 1 auto;
        display: block;
        background-size: cover;
        background-position: center;
        overflow: hidden;
      }
      .transparency-notice {
        flex: 0 0 auto;
        font-size: 10px;
      }
      .overlay-title {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        padding: 4px 8px;
        background: rgba(0, 0, 0, 0.6);
        color: white;
        font-size: 0.9rem;
        line-height: 1.1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        box-sizing: border-box;
        pointer-events: none;
        text-align: center
      }
    `,this.shadow.prepend(e)}showError(e){let t=document.createElement("div");t.setAttribute("role","alert"),t.setAttribute("aria-live","polite"),t.textContent=e,t.style.fontSize="12px",t.style.color="#900",t.style.background="#fee",t.style.padding="6px",t.style.border="1px solid #c00",t.style.borderRadius="4px",this.shadow.appendChild(t)}initialize(){if(this.shadow.innerHTML="",this.currentPlayButton&&this.currentPlayButtonHandler&&(this.currentPlayButton.removeEventListener("click",this.currentPlayButtonHandler),this.currentPlayButton=void 0,this.currentPlayButtonHandler=void 0),this.mediaContainer=void 0,this.previewImageId=void 0,this.serviceName=this.getAttribute("service")||void 0,!this.serviceName){console.error("media-embed: missing service attribute"),this.showError("Media embed misconfigured: missing service attribute.");return}if(this.service=c.get(this.serviceName),!this.service){console.error(`media-embed: unknown service "${this.serviceName}"`),this.showError(`Media embed misconfigured: unknown service "${this.serviceName}".`);return}let e=Array.isArray(this.service.idAttr)?[...this.service.idAttr]:[this.service.idAttr];this.serviceName==="youtube"&&(e=["playlistid",...e]),this.embedId=null;for(let t of e){let i=this.getAttribute(t);if(i){this.embedId=i.trim(),this.usedIdAttr=t;break}}if(!this.embedId){console.error(`media-embed: missing id attribute (${e.join("/")}) for service ${this.serviceName}`),this.showError(`Media embed misconfigured: missing id attribute for service ${this.serviceName}.`);return}this.renderPreview(),g()&&this.upgradeToIframe()}renderPreview(){if(!this.embedId)return;this.ensureStyles();let e=document.createElement("div");e.className="preview-wrapper";let t=document.createElement("div");if(t.className="media-container",this.mediaContainer=t,this.serviceName==="soundcloud"&&this.usedIdAttr==="trackid"){let s=`https://w1.sndcdn.com/${encodeURIComponent(this.embedId)}_m.png`;t.style.backgroundImage=`url("${s}")`,this.previewImageId=this.embedId}else if(this.serviceName==="youtube"&&this.usedIdAttr==="playlistid"){let s=this.getAttribute("itemid");if(s){let o=d("https://i.ytimg.com/vi/{id}/hqdefault.jpg",{id:s});t.style.backgroundImage=`url("${o}")`,this.previewImageId=s}}else if(this.service?.thumbnailTemplate){let s=d(this.service.thumbnailTemplate,{id:this.embedId});t.style.backgroundImage=`url("${s}")`,this.previewImageId=this.embedId}let i=document.createElement("a");if(i.href=this.getWatchUrl(),i.target="_blank",i.rel="noopener",i.setAttribute("aria-label",this.playLabel),i.setAttribute("title",this.titleText||this.playLabel),i.style.display="block",i.style.width="100%",i.style.height="100%",i.dataset.preview="false",t.appendChild(i),this.titleText){let s=document.createElement("div");s.className="overlay-title",s.setAttribute("part","overlay-title"),s.textContent=this.titleText,s.setAttribute("aria-label",this.titleText),s.setAttribute("title",this.titleText),t.appendChild(s)}let r;if(this.service?.playButtonHTML){let s=this.service.playButtonHTML.replaceAll("{label}",v(this.playLabel)),o=document.createElement("template");o.innerHTML=s.trim();let l=o.content.firstElementChild;if(l){r=l;let p=b=>{b.stopPropagation(),b.preventDefault(),g()?this.upgradeToIframe():window.open(this.getWatchUrl(),"_blank","noopener")};r.addEventListener("click",p),this.currentPlayButton=r,this.currentPlayButtonHandler=p}else r=this.defaultPlayButton()}else r=this.defaultPlayButton();if(t.appendChild(r),e.appendChild(t),this.service?.transparencyNoticeHTML){let s=document.createElement("div");s.setAttribute("role","note"),s.className="transparency-notice",s.setAttribute("part","transparency-notice"),s.innerHTML=this.service.transparencyNoticeHTML,e.appendChild(s)}this.shadow.appendChild(e),this.resolveOEmbedThumbnail(),this.service?.highResPosterTemplate&&(this.serviceName==="youtube"&&this.usedIdAttr==="playlistid"&&!this.previewImageId||this.upgradePosterImage())}defaultPlayButton(){let e=document.createElement("div");return e.className="default-playbtn",e.textContent="\u25B6",e.setAttribute("aria-hidden","true"),e}getWatchUrl(){if(!this.service||!this.embedId)return"#";if(this.serviceName==="youtube"&&this.usedIdAttr==="playlistid"){let e=this.getAttribute("itemid");if(e){let t=new URL(`https://youtu.be/${encodeURIComponent(e)}`);t.searchParams.set("list",this.embedId);let i=this.playlistIndex;return i&&t.searchParams.set("index",String(i)),t.toString()}else{let t=new URL("https://www.youtube.com/playlist");t.searchParams.set("list",this.embedId);let i=this.playlistIndex;return i&&t.searchParams.set("index",String(i)),t.toString()}}if(this.serviceName==="soundcloud"){let e=this.getAttribute("permalink");if(e)return`https://soundcloud.com/${e.replace(/^\/+|\/+$/g,"")}`;if(this.isProbablyUrl(this.embedId))return this.embedId;if(this.service.watchFallbackSearchTemplate)return d(this.service.watchFallbackSearchTemplate,{id:this.embedId})}if(this.service.watchUrlTemplate){let e=this.service.watchUrlTemplate;try{return/\{id\}/.test(e)?d(e,{id:this.embedId}):/\{url\}/.test(e)?d(e,{url:this.embedId},{encode:!1}):/\{watchable\}/.test(e)?this.embedId:e}catch(t){return console.error("media-embed: error building watch URL from template",t),"#"}}if(this.service.embedBaseTemplate){let e=this.service.embedBaseTemplate;e=e.replace("{id}",encodeURIComponent(this.embedId)),e=e.replace("{url}",encodeURIComponent(this.embedId));try{return e}catch(t){return console.error("media-embed: invalid embed base template for watch URL",t),"#"}}return"#"}shouldAutoplay(){return this.autoplay}buildEmbedUrl(){if(!this.service||!this.embedId)return"#";if(this.serviceName==="youtube"&&this.usedIdAttr==="playlistid"){let i=this.getAttribute("itemid");if(i){let r;try{r=new URL(`https://www.youtube-nocookie.com/embed/${encodeURIComponent(i)}`)}catch{return"#"}r.searchParams.set("list",this.embedId),this.shouldAutoplay()&&r.searchParams.set("autoplay","1"),r.searchParams.set("playsinline","1");for(let[s,o]of this.extraParams.entries())r.searchParams.set(s,o);return r.toString()}else{let r;try{r=new URL("https://www.youtube-nocookie.com/embed/videoseries")}catch{return"#"}r.searchParams.set("list",this.embedId);let s=this.playlistIndex;s&&r.searchParams.set("index",String(s)),this.shouldAutoplay()&&r.searchParams.set("autoplay","1"),r.searchParams.set("playsinline","1");for(let[o,l]of this.extraParams.entries())r.searchParams.set(o,l);return r.toString()}}if(this.serviceName==="soundcloud"){let i=`https://api.soundcloud.com/tracks/${encodeURIComponent(this.embedId)}`,r;try{r=new URL(this.service.embedBaseTemplate)}catch(o){return console.error("media-embed: invalid SoundCloud embed base template",o),"#"}let s=new URLSearchParams;if(this.service.defaultEmbedParams)for(let[o,l]of Object.entries(this.service.defaultEmbedParams))s.set(o,l);if(s.set("url",i),this.shouldAutoplay()){let o=this.service.autoplayParam||"auto_play";s.set(o,"true")}for(let[o,l]of this.extraParams.entries())s.set(o,l);return r.search=s.toString(),r.toString()}let e=this.service.embedBaseTemplate||"";e=e.replace("{id}",encodeURIComponent(this.embedId)),e=e.replace("{url}",encodeURIComponent(this.embedId));let t;try{t=new URL(e)}catch(i){return console.error("media-embed: invalid embed base template",i),"#"}["youtube","vimeo"].includes(this.serviceName||"")&&this.shouldAutoplay()&&t.searchParams.set("autoplay","1"),this.serviceName==="youtube"&&t.searchParams.set("playsinline","1");for(let[i,r]of this.extraParams.entries())t.searchParams.set(i,r);return t.toString()}upgradePosterImage(){if(!this.service?.highResPosterTemplate)return;let e=this.previewImageId||this.embedId;if(!e)return;let t=d(this.service.highResPosterTemplate,{id:e}),i=new Image;i.fetchPriority="low",i.referrerPolicy="origin",i.src=t,i.onload=()=>{this.mediaContainer?this.mediaContainer.style.backgroundImage=`url("${t}")`:this.style.backgroundImage=`url("${t}")`}}isProbablyUrl(e){return/^(https?:)?\/\//i.test(e)}upgradeToIframe(){if(this.shadow.querySelector("iframe")||!this.embedId)return;let e=document.createElement("iframe");e.width="100%",e.height="100%",e.title=this.titleText||this.playLabel,e.allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",e.allowFullscreen=!0,e.loading="lazy",e.src=this.buildEmbedUrl(),this.currentPlayButton&&this.currentPlayButtonHandler&&(this.currentPlayButton.removeEventListener("click",this.currentPlayButtonHandler),this.currentPlayButton=void 0,this.currentPlayButtonHandler=void 0),this.shadow.innerHTML="",this.shadow.appendChild(e)}resolveOEmbedThumbnail(){if(!this.embedId)return;let e=null;if(this.serviceName==="soundcloud"){let r=this.getAttribute("permalink");r?e=`https://soundcloud.com/${r.replace(/^\/+|\/+$/g,"")}`:this.isProbablyUrl(this.embedId)&&(e=this.embedId)}else this.serviceName==="vimeo"?e=`https://vimeo.com/${encodeURIComponent(this.embedId)}`:this.serviceName==="youtube"&&this.usedIdAttr==="playlistid"&&!this.previewImageId&&(e=this.getWatchUrl());if(!e||!this.service?.thumbnailOEmbedEndpointTemplate)return;let t=e.replace(/\/+$/,""),i=d(this.service.thumbnailOEmbedEndpointTemplate,{url:t});fetch(i).then(r=>r.ok?r.json():Promise.reject()).then(r=>{if(r?.thumbnail_url){let s=r.thumbnail_url;this.mediaContainer?this.mediaContainer.style.backgroundImage=`url("${s}")`:this.style.backgroundImage=`url("${s}")`}}).catch(()=>{})}};customElements.get("media-embed")||customElements.define("media-embed",h);window.addEventListener("media-embed-consent-granted",()=>{document.querySelectorAll("media-embed").forEach(a=>{typeof a.upgradeToIframe=="function"&&a.upgradeToIframe()})});})();
